<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Unknown Types in Go are the Worst Chris Coyier | VibeX</title><meta name=generator content="Hugo 0.98.0"><meta name=description content="Say you have some data and it’s either an int or a string (of an int). thing1 := thing{num: 2} thing2 := thing{num: &#34;31&#34;}Code language: Go (go) Well, that sucks. Go is a typed language and this bit of data really should be properly an int. But, ya know, the world is a mess sometimes. Perhaps you have a giant database of JSON data put in there over a decade and this num value is sometimes a proper int and sometimes a string-of-an-int."><link rel=stylesheet href=https://assets.cdnweb.info/hugo/cayman/css/normalize.css><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel=stylesheet type=text/css><link rel=stylesheet href=https://assets.cdnweb.info/hugo/cayman/css/cayman.css><link rel=apple-touch-icon sizes=180x180 href=./apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=./favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=./favicon-16x16.png><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css integrity=sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js integrity=sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script></head><body><section class=page-header><h1 class=project-name>VibeX</h1><h2 class=project-tagline></h2><nav><a href=./index.html class=btn>Blog</a>
<a href=./sitemap.xml class=btn>Sitemap</a>
<a href=./index.xml class=btn>RSS</a></nav></section><section class=main-content><h1>Unknown Types in Go are the Worst Chris Coyier</h1><div><strong>Publish date: </strong>2024-05-27</div><img src=https://cdn.statically.io/img/i0.wp.com/chriscoyier.net/wp-content/uploads/2021/07/IsUISvAq_400x400.jpg style=margin:auto;display:block;text-align:center;max-width:100%;height:auto><p>Say you have some data and it’s either an <code>int</code> or a <code>string</code> (of an int).</p><pre class=wp-block-code aria-describedby=shcb-language-1 data-shcb-language-name=Go data-shcb-language-slug=go><span><code class="hljs language-go">thing1 := thing{num: <span class=hljs-number>2</span>} thing2 := thing{num: <span class=hljs-string>"31"</span>}</code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>Go</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>go</span><span class=shcb-language__paren>)</span></pre><p>Well, that sucks.</p><p>Go is a typed language and this bit of data really should be properly an <code>int</code>. But, ya know, the world is a mess sometimes. Perhaps you have a giant database of JSON data put in there over a decade and this <code>num</code> value is sometimes a proper int and sometimes a string-of-an-int. We might have to <code>json.Unmarshal</code> that data, and the only way we’ll be able to do that safely is a forgiving type. Poop happens.</p><p>Assuming we can’t up and fix the data in the database right this second, we have to code around it. So our <code>thing</code> type needs to be forgiving:</p><pre class=wp-block-code aria-describedby=shcb-language-2 data-shcb-language-name=PHP data-shcb-language-slug=php><span><code class="hljs language-php">type thing struct { num <span class=hljs-class><span class=hljs-keyword>interface</span></span>{} }</code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>PHP</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>php</span><span class=shcb-language__paren>)</span></pre><p>YEAH FINE.</p><p>But this problem is going to keeping spreading its ugly tentacles. There is a good chance that <code>num</code> really wants to be an <code>int</code> and when it interacts with other code, the expectation that it is an <code>int</code> will be enforced.</p><p>Maybe we just have the world’s simplest little function that prints the int it accepts:</p><pre class=wp-block-code><span><code class=hljs>func printNumber(i int) { fmt.Println(i) }</code></span></pre><p>Can we use it with our data?</p><pre class=wp-block-code aria-describedby=shcb-language-3 data-shcb-language-name=CSS data-shcb-language-slug=css><span><code class="hljs language-css"><span class=hljs-selector-tag>printNumber</span>(<span class=hljs-selector-tag>thing1</span><span class=hljs-selector-class>.num</span>) <span class=hljs-selector-tag>printNumber</span>(<span class=hljs-selector-tag>thing2</span><span class=hljs-selector-class>.num</span>)</code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>CSS</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>css</span><span class=shcb-language__paren>)</span></pre><p>Absolutely not. We don’t have an <code>int</code>, we have an <code>interface{}</code>. In JavaScript, we could toss whatever through <code>parseInt()</code> and it will come out as an integer. No such loosey-goosey action in Go.</p><ul><li>There is an <code>int()</code> function, but it’ll choke on the string.</li><li>Likewise, <code>thing1.num.(int)</code> will choke on the string.</li></ul><p>So, we’ll need to look at the value, check the type, and then really explicitly perform a conversion based on the type we find.</p><pre class=wp-block-code aria-describedby=shcb-language-4 data-shcb-language-name=PHP data-shcb-language-slug=php><span><code class="hljs language-php">func intFromInterface(v <span class=hljs-class><span class=hljs-keyword>interface</span></span>{}) (int, error) { <span class=hljs-keyword>switch</span> v := v.(type) { <span class=hljs-keyword>case</span> int: <span class=hljs-keyword>return</span> int(v), nil <span class=hljs-keyword>case</span> string: c, err := strconv.Atoi(v) <span class=hljs-keyword>if</span> err != nil { <span class=hljs-keyword>return</span> <span class=hljs-number>0</span>, err } <span class=hljs-keyword>return</span> c, nil <span class=hljs-keyword>default</span>: <span class=hljs-keyword>return</span> <span class=hljs-number>0</span>, fmt.Errorf(<span class=hljs-string>"conversion to int from %T not supported"</span>, v) } }</code></span><span class=shcb-language__label>Code language:</span> <span class=shcb-language__name>PHP</span> <span class=shcb-language__paren>(</span><span class=shcb-language__slug>php</span><span class=shcb-language__paren>)</span></pre><p>You might want to add more types to that if your data has more potential types. Floats and whatnot.</p><p>That’s a big messy function if you ask me, but it’s better to get the data converted into the type it should be in as early as possible, rather than passing it around as an <code>interface{}</code> and passing the buck on converting the type to other places.</p><p><a href=#>Here’s a playground link</a> of all that.</p><figure class="wp-block-embed is-type-rich is-provider-twitter wp-block-embed-twitter" readability=2><p>https://twitter.com/Robb0wen/status/1536404941086019586</p></figure><figure class="wp-block-embed is-type-rich is-provider-twitter wp-block-embed-twitter"><p lang=en dir=ltr>This is a pain. One thing I’ve found handy for this is using custom JSON unmarshalling functions to map inconsistent datas type in the json, to a proper type in the go struct. Here’s a solid post about the technique <a href=#>https://t.co/pIYNSVscB0</a></p>— Shayne O'Sullivan (@ShayneOSullivan) <a href=#>June 13, 2022</a></figure><p><h3 class=jp-relatedposts-headline>Related</h3></p><p class=postsid style=color:rgba(255,0,0,0)>ncG1vNJzZmibmKe2tK%2FOsqCeql6jsrV7kWlpa2dga3xyfo6upaSmn6y7bsDYqZysZZmjeqi7jJqpnmWknbJuw86rqq1n</p><footer class=site-footer><span class=site-footer-credits>Made with <a href=https://gohugo.io/>Hugo</a>. © 2022. All rights reserved.</span></footer></section><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/floating.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/tracking_server_6.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="//analytics.cdnweb.info/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script></body></html>